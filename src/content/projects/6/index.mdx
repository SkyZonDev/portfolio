## Contexte & Objectifs

Ce projet est nÃ© d'un besoin de crÃ©er une solution d'authentification flexible et rÃ©utilisable, capable de s'adapter Ã  diffÃ©rents environnements et bases de donnÃ©es. L'objectif Ã©tait de dÃ©velopper une API REST modulaire qui dÃ©montre mes compÃ©tences en dÃ©veloppement backend et en sÃ©curitÃ© des APIs.

### ProblÃ©matique initiale

Les projets nÃ©cessitent souvent des systÃ¨mes d'authentification, mais chaque projet peut avoir des contraintes diffÃ©rentes :

- **Bases de donnÃ©es variÃ©es** : PostgreSQL pour les projets relationnels, MongoDB pour les projets NoSQL, MySQL pour la compatibilitÃ©
- **Besoin de flexibilitÃ©** : Pouvoir changer de base de donnÃ©es sans rÃ©Ã©crire tout le code
- **SÃ©curitÃ© robuste** : ImplÃ©menter les meilleures pratiques de sÃ©curitÃ© API
- **RÃ©utilisabilitÃ©** : CrÃ©er une solution modulaire utilisable dans plusieurs projets

### Objectifs du projet

- **Architecture modulaire** : Support de PostgreSQL, MongoDB et MySQL via une interface unifiÃ©e
- **Configuration flexible** : Choix de la base de donnÃ©es par opÃ©ration via configuration
- **SÃ©curitÃ© renforcÃ©e** : ImplÃ©mentation des standards de sÃ©curitÃ© API (JWT, validation, protection XSS)
- **ExtensibilitÃ©** : Architecture permettant d'ajouter facilement de nouvelles bases de donnÃ©es
- **DÃ©monstration de compÃ©tences** : Mise en valeur des compÃ©tences backend et sÃ©curitÃ©

## Solution & Approche

### Architecture modulaire

L'API repose sur une architecture en couches permettant de changer de base de donnÃ©es sans modifier la logique mÃ©tier :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API REST Layer              â”‚
â”‚  (Routes, Controllers, Middleware)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Business Logic Layer           â”‚
â”‚  (Services, Authentication Logic)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Data Access Layer              â”‚
â”‚  (Repository Pattern)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database Adapters                 â”‚
â”‚  PostgreSQL â”‚ MongoDB â”‚ MySQL       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Patterns de conception

L'architecture utilise plusieurs patterns de conception pour garantir la modularitÃ© :

- **Factory Pattern** : `DatabaseFactory` pour crÃ©er dynamiquement les connexions selon le type de base de donnÃ©es
- **Repository Pattern** : `UserRepository` pour abstraire l'accÃ¨s aux donnÃ©es et dÃ©coupler la logique mÃ©tier
- **Configuration par opÃ©ration** : Choix de la base de donnÃ©es via `db.config.js` pour chaque type d'opÃ©ration (login, register, etc.)

Cette approche permet de :

- **Changer de base de donnÃ©es** sans modifier le code mÃ©tier
- **Utiliser diffÃ©rentes bases** pour diffÃ©rentes opÃ©rations si nÃ©cessaire
- **Ajouter facilement** de nouvelles bases de donnÃ©es

### FonctionnalitÃ©s principales

#### ğŸ” Authentification

- **Inscription** : CrÃ©ation de compte avec validation des donnÃ©es (email, username, password)
- **Connexion** : Authentification sÃ©curisÃ©e avec gÃ©nÃ©ration de tokens JWT
- **Validation complÃ¨te** : VÃ©rification du format email, longueur des mots de passe et usernames

#### ğŸ”’ SÃ©curitÃ©

- **Hachage des mots de passe** : Utilisation de `bcryptjs` avec salt rounds configurables
- **Tokens JWT** : GÃ©nÃ©ration de tokens sÃ©curisÃ©s avec expiration (24h)
- **Protection XSS** : Sanitization automatique des entrÃ©es utilisateur
- **Helmet** : SÃ©curisation des headers HTTP
- **CORS configurÃ©** : ContrÃ´le des origines autorisÃ©es
- **Validation stricte** : Validation cÃ´tÃ© serveur de toutes les donnÃ©es d'entrÃ©e

## Stack technique

### Backend Core

- **Node.js + Express** : Framework web performant et flexible
- **JavaScript (CommonJS)** : Code modulaire et maintenable

### Bases de donnÃ©es supportÃ©es

- **PostgreSQL** : Via `pg` (driver natif) avec connection pooling
- **MongoDB** : Via `mongoose` pour la flexibilitÃ© NoSQL
- **MySQL** : Via `mysql2` avec support des promesses

### SÃ©curitÃ© & Authentification

- **jsonwebtoken** : GÃ©nÃ©ration et vÃ©rification des tokens JWT
- **bcryptjs** : Hachage sÃ©curisÃ© des mots de passe avec salt configurable
- **helmet** : SÃ©curisation des headers HTTP
- **express-validator** : BibliothÃ¨que de validation (installÃ©e)
- **Validation custom** : Middleware de validation personnalisÃ© pour email, password, username
- **Protection XSS** : Sanitization automatique des entrÃ©es dans le middleware Express

### Configuration

- **dotenv** : Gestion des variables d'environnement
- **Configuration flexible** : Activation/dÃ©sactivation des bases de donnÃ©es via variables d'environnement
- **db.config.js** : Configuration centralisÃ©e pour choisir la base de donnÃ©es par opÃ©ration

## DÃ©fis techniques

### Abstraction multi-base de donnÃ©es

Le principal dÃ©fi Ã©tait de crÃ©er une abstraction permettant de supporter plusieurs bases de donnÃ©es sans dupliquer la logique mÃ©tier :

**Solutions implÃ©mentÃ©es :**

- **DatabaseFactory** : Pattern Factory pour crÃ©er dynamiquement les connexions (MongoDB, PostgreSQL, MySQL)
- **Repository Pattern** : `UserRepository` avec mÃ©thodes unifiÃ©es (`create`, `findByEmail`) qui s'adaptent automatiquement
- **Configuration par opÃ©ration** : Choix de la base de donnÃ©es via `db.config.js` (ex: utiliser PostgreSQL pour login/register)
- **Switches conditionnels** : ImplÃ©mentation spÃ©cifique pour chaque base de donnÃ©es dans le repository
- **Connection pooling** : Utilisation native des pools pour PostgreSQL et MySQL

### SÃ©curitÃ© de l'authentification

ImplÃ©mentation des meilleures pratiques de sÃ©curitÃ© :

- **Tokens JWT sÃ©curisÃ©s** : Signature avec secret fort (via variable d'environnement), expiration de 24h
- **Hachage robuste** : `bcryptjs` avec salt rounds configurables via `JWT_SALT`
- **Validation stricte** : Middleware de validation custom pour email (regex), password (min 6 caractÃ¨res), username (min 3 caractÃ¨res)
- **Protection XSS** : Sanitization automatique des entrÃ©es (remplacement de `<` et `>`)
- **Helmet** : SÃ©curisation des headers HTTP pour prÃ©venir les attaques courantes

### Gestion des connexions multiples

- **Connexions simultanÃ©es** : PossibilitÃ© d'activer plusieurs bases de donnÃ©es en mÃªme temps
- **SÃ©lection dynamique** : Choix de la base de donnÃ©es appropriÃ©e selon l'opÃ©ration demandÃ©e
- **Gestion d'erreurs** : Gestion robuste des erreurs de connexion pour chaque base de donnÃ©es

## FonctionnalitÃ©s dÃ©taillÃ©es

### Endpoints d'authentification

```
POST   /v1/auth/register  - Inscription d'un nouvel utilisateur
POST   /v1/auth/login     - Connexion et obtention d'un token JWT
GET    /                  - Statut de l'API et bases de donnÃ©es actives
```

### Structure des requÃªtes

**Inscription (`/v1/auth/register`)** :

```json
{
  "username": "exemple",
  "email": "exemple@email.com",
  "password": "motdepasse"
}
```

**Connexion (`/v1/auth/login`)** :

```json
{
  "email": "exemple@email.com",
  "password": "motdepasse"
}
```

**RÃ©ponse** (pour les deux endpoints) :

```json
{
  "message": "Utilisateur crÃ©Ã© avec succÃ¨s" / "Connexion rÃ©ussie",
  "token": "jwt_token",
  "user": {
    "id": "userId",
    "email": "userEmail",
    "username": "username"
  }
}
```

### Middleware de sÃ©curitÃ©

- **Validation middleware** : `validateRegistration` et `validateLogin` pour vÃ©rifier les donnÃ©es d'entrÃ©e
- **Sanitization XSS** : Middleware global pour protÃ©ger contre les injections XSS
- **Helmet** : Protection des headers HTTP
- **CORS** : Configuration des origines autorisÃ©es

## RÃ©sultats & Impact

### FonctionnalitÃ©s livrÃ©es

- âœ… **Support multi-base de donnÃ©es** : PostgreSQL, MongoDB et MySQL opÃ©rationnels
- âœ… **API REST fonctionnelle** : Endpoints d'inscription et de connexion opÃ©rationnels
- âœ… **SÃ©curitÃ© renforcÃ©e** : ImplÃ©mentation des meilleures pratiques (JWT, bcrypt, validation, XSS protection)
- âœ… **Architecture modulaire** : Facilement extensible et maintenable avec Factory et Repository patterns
- âœ… **Configuration flexible** : Choix de la base de donnÃ©es par opÃ©ration via configuration
- âœ… **Documentation** : README complet avec exemples d'utilisation

### DÃ©monstration de compÃ©tences

Ce projet met en valeur :

- **Architecture logicielle** : Conception d'une architecture modulaire et extensible
- **SÃ©curitÃ© API** : MaÃ®trise des standards de sÃ©curitÃ© (JWT, bcrypt, validation, protection XSS)
- **Multi-database** : CapacitÃ© Ã  travailler avec diffÃ©rents types de bases de donnÃ©es (relationnelles et NoSQL)
- **Patterns de design** : Utilisation appropriÃ©e de Repository et Factory patterns
- **Abstraction** : CrÃ©ation d'une couche d'abstraction efficace pour gÃ©rer plusieurs bases de donnÃ©es

### Impact technique

- **RÃ©utilisabilitÃ©** : Base solide pour intÃ©grer l'authentification dans d'autres projets
- **FlexibilitÃ©** : Changement de base de donnÃ©es sans impact sur le code mÃ©tier grÃ¢ce au Repository pattern
- **MaintenabilitÃ©** : Code structurÃ© en couches (routes, controllers, repositories, models)
- **SÃ©curitÃ©** : ImplÃ©mentation robuste des mÃ©canismes de sÃ©curitÃ© (hachage, JWT, validation, sanitization)

## Ce que j'ai appris

### CompÃ©tences techniques

- **Architecture modulaire** : Conception de systÃ¨mes extensibles et maintenables avec sÃ©paration des responsabilitÃ©s
- **Pattern Repository** : Abstraction efficace de l'accÃ¨s aux donnÃ©es pour supporter plusieurs bases de donnÃ©es
- **Factory Pattern** : CrÃ©ation dynamique d'objets (connexions DB) selon la configuration
- **SÃ©curitÃ© API** : ImplÃ©mentation des mÃ©canismes de sÃ©curitÃ© (JWT, bcrypt, validation, protection XSS)
- **Multi-database** : Gestion de diffÃ©rentes bases de donnÃ©es (PostgreSQL, MongoDB, MySQL) avec une interface unifiÃ©e
- **Drivers natifs** : Utilisation de drivers natifs (`pg`, `mysql2`, `mongoose`) pour optimiser les performances

### CompÃ©tences transversales

- **Design patterns** : Application appropriÃ©e des patterns de conception (Factory, Repository)
- **Configuration flexible** : CrÃ©ation d'un systÃ¨me de configuration permettant de choisir la base de donnÃ©es par opÃ©ration
- **Documentation** : CrÃ©ation d'une documentation claire avec exemples d'utilisation
- **SÃ©curitÃ©** : ComprÃ©hension approfondie des enjeux de sÃ©curitÃ© API et implÃ©mentation de protections

## Ã‰volutions futures

### AmÃ©liorations d'authentification

- **Refresh tokens** : ImplÃ©mentation d'un systÃ¨me de refresh tokens pour amÃ©liorer la sÃ©curitÃ©
- **DÃ©connexion** : Endpoint de dÃ©connexion avec invalidation des tokens
- **RÃ©cupÃ©ration de mot de passe** : SystÃ¨me de reset de mot de passe via email
- **2FA / MFA** : Authentification Ã  deux facteurs (SMS, TOTP)
- **OAuth2 / OIDC** : Support de l'authentification OAuth2 et OpenID Connect
- **Social login** : Connexion via Google, GitHub, etc.

### Extensions fonctionnelles

- **Gestion des utilisateurs** : CRUD complet pour les utilisateurs (GET, PUT, DELETE)
- **Gestion des rÃ´les** : SystÃ¨me de rÃ´les et permissions avancÃ© (RBAC)
- **Profil utilisateur** : Endpoints pour gÃ©rer les informations personnelles
- **Changement de mot de passe** : Endpoint dÃ©diÃ© pour la mise Ã  jour du mot de passe
- **Sessions multiples** : Gestion de plusieurs sessions par utilisateur

### AmÃ©liorations techniques

- **Rate limiting** : Protection contre les attaques par force brute avec `express-rate-limit`
- **Tests** : Ajout de tests unitaires et d'intÃ©gration (Jest, Supertest)
- **Documentation API** : IntÃ©gration de Swagger/OpenAPI pour une documentation interactive
- **Validation avancÃ©e** : Utilisation complÃ¨te d'`express-validator` pour une validation plus robuste
- **Logging structurÃ©** : SystÃ¨me de logs centralisÃ© et structurÃ© pour le debugging

### Optimisations

- **Cache Redis** : Mise en cache des tokens et sessions pour amÃ©liorer les performances
- **Connection pooling avancÃ©** : Optimisation des pools de connexions
- **Indexation** : Ajout d'index sur les champs frÃ©quemment interrogÃ©s (email, username)
- **Monitoring** : IntÃ©gration avec des outils de monitoring (Prometheus, Grafana)
